@* Summary card for bulk requests with key metrics *@
@using Requestr.Core.Models

<div class="bulk-summary-card card mb-4">
    <div class="card-body">
        <!-- Header with form name and request type -->
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <h5 class="card-title mb-1">@FormName</h5>
                <div class="d-flex align-items-center gap-2 flex-wrap">
                    @if (!string.IsNullOrEmpty(TableName))
                    {
                        <small class="text-muted">
                            <i class="bi bi-table me-1"></i>@TableName
                        </small>
                    }
                    <small class="text-muted">
                        <i class="bi bi-list-ol me-1"></i>@TotalRows rows
                    </small>
                </div>
            </div>
            <div class="d-flex align-items-center gap-2">
                <span class="badge @GetRequestTypeBadgeClass() fs-6">
                    @GetRequestTypeLabel()
                </span>
                <span class="badge @GetStatusBadgeClass() fs-6">
                    @Status
                </span>
            </div>
        </div>

        <!-- Comments section (if provided) -->
        @if (!string.IsNullOrEmpty(Comments))
        {
            <div class="mt-3 pt-3 border-top">
                <div class="d-flex align-items-start gap-2">
                    <i class="bi bi-chat-left-text text-muted"></i>
                    <div>@Comments</div>
                </div>
            </div>
        }

        <!-- Processing summary (for completed bulk requests) -->
        @if (!string.IsNullOrEmpty(ProcessingSummary))
        {
            <div class="mt-3 p-3 @GetProcessingSummaryBackgroundClass() border rounded">
                <div class="d-flex align-items-start gap-2">
                    <i class="bi @GetProcessingSummaryIcon() @GetProcessingSummaryIconColor()"></i>
                    <div>
                        <strong class="d-block">Processing Summary</strong>
                        <span>@ProcessingSummary</span>
                    </div>
                </div>
            </div>
        }
    
        <!-- Metadata footer -->
        <div class="mt-3 pt-3 border-top small">
            <div class="d-flex flex-wrap gap-3">
                @if (!string.IsNullOrEmpty(SubmittedBy))
                {
                    <span class="text-muted">
                        <i class="bi bi-person me-1"></i>@SubmittedBy
                    </span>
                }
                @if (SubmittedAt.HasValue)
                {
                    <span class="text-muted">
                        <i class="bi bi-calendar me-1"></i>@SubmittedAt.Value.ToString("MMM dd, yyyy 'at' h:mm tt")
                    </span>
                }
            </div>
            @if (!string.IsNullOrEmpty(ProcessedBy))
            {
                <div class="mt-2">
                    <span class="text-muted">
                        <i class="bi bi-check-circle me-1"></i>Processed by @ProcessedBy
                        @if (ProcessedAt.HasValue)
                        {
                            <span>on @ProcessedAt.Value.ToString("MMM dd, yyyy 'at' h:mm tt")</span>
                        }
                    </span>
                </div>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public string FormName { get; set; } = string.Empty;
    [Parameter] public string? TableName { get; set; }
    [Parameter] public RequestType RequestType { get; set; }
    [Parameter] public int TotalRows { get; set; }
    [Parameter] public RequestStatus Status { get; set; }
    [Parameter] public string? Comments { get; set; }
    [Parameter] public string? ProcessingSummary { get; set; }
    [Parameter] public string? SubmittedBy { get; set; }
    [Parameter] public DateTime? SubmittedAt { get; set; }
    [Parameter] public string? ProcessedBy { get; set; }
    [Parameter] public DateTime? ProcessedAt { get; set; }

    private string GetStatusBadgeClass() => Status switch
    {
        RequestStatus.Pending => "bg-warning text-dark",
        RequestStatus.Approved => "bg-success",
        RequestStatus.Rejected => "bg-danger",
        RequestStatus.Applied => "bg-info",
        RequestStatus.Failed => "bg-danger",
        _ => "bg-secondary"
    };

    private string GetRequestTypeBadgeClass() => RequestType switch
    {
        RequestType.Insert => "bg-success",
        RequestType.Update => "bg-primary",
        RequestType.Delete => "bg-danger",
        _ => "bg-secondary"
    };

    private string GetRequestTypeLabel() => RequestType switch
    {
        RequestType.Insert => "Bulk Insert",
        RequestType.Update => "Bulk Update",
        RequestType.Delete => "Bulk Delete",
        _ => RequestType.ToString()
    };

    private string GetProcessingSummaryBackgroundClass() => Status switch
    {
        RequestStatus.Applied => "bg-success bg-opacity-10 border-success",
        RequestStatus.Failed => "bg-danger bg-opacity-10 border-danger",
        _ => "bg-info bg-opacity-10 border-info"
    };

    private string GetProcessingSummaryIcon() => Status switch
    {
        RequestStatus.Applied => "bi-check-circle-fill",
        RequestStatus.Failed => "bi-exclamation-triangle-fill",
        _ => "bi-info-circle-fill"
    };

    private string GetProcessingSummaryIconColor() => Status switch
    {
        RequestStatus.Applied => "text-success",
        RequestStatus.Failed => "text-danger",
        _ => "text-info"
    };
}
